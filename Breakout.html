<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Luffy's Ultimate Breakout üî•</title>
    <style>
        body { margin: 0; overflow: hidden; background: black; touch-action: none; text-align: center; }
        canvas { display: block; margin: auto; background: #111; }
        #hud {
            position: fixed; top: 10px; width: 100%; color: cyan; font-family: Arial; text-shadow: 0 0 10px cyan;
        }
        #powerup-status { margin-top: 5px; font-size: 14px; }
        #progress {
            width: 200px; height: 10px; background: #222; margin: 10px auto; border-radius: 5px; overflow: hidden;
        }
        #progress-bar {
            width: 0%; height: 100%; background: cyan; transition: width 0.3s; border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="hud">
        SCORE: <span id="score">0</span> | LIVES: <span id="lives">3</span>
        <div id="powerup-status"></div>
        <div id="progress"><div id="progress-bar"></div></div>
    </div>
    <canvas id="game"></canvas>

    <script>
        // üéÆ Setup
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        canvas.width = 800; canvas.height = 600;
        let score = 0, lives = 3, level = 1;

        // üèì Paddle
        const paddle = { x: canvas.width/2 - 50, y: canvas.height - 20, w: 100, h: 15, speed: 0 };
        
        // üèÄ Ball
        const ball = { x: canvas.width/2, y: canvas.height/2, dx: 4, dy: -4, size: 8 };

        // üß± Bricks
        let bricks = [];
        function createLevel() {
            bricks = [];
            const colors = ["#ff3333", "#ff9933", "#33ff33", "#33ffff"];
            for (let i = 0; i < 6 + level; i++) {
                for (let j = 0; j < 10; j++) {
                    bricks.push({ x: j * 80 + 10, y: i * 30 + 50, w: 70, h: 20, color: colors[i % 4], health: i < 2 ? 3 : 2 });
                }
            }
        }
        createLevel();

        // üéÆ Controls
        document.addEventListener("keydown", (e) => {
            if (e.key === "ArrowLeft") paddle.speed = -8;
            if (e.key === "ArrowRight") paddle.speed = 8;
        });
        document.addEventListener("keyup", () => paddle.speed = 0);

        // üé¨ Game Loop
        function update() {
            paddle.x += paddle.speed;
            if (paddle.x < 0) paddle.x = 0;
            if (paddle.x > canvas.width - paddle.w) paddle.x = canvas.width - paddle.w;

            ball.x += ball.dx;
            ball.y += ball.dy;

            if (ball.x < 0 || ball.x > canvas.width) ball.dx *= -1;
            if (ball.y < 0) ball.dy *= -1;
            if (ball.y > canvas.height) {
                lives--;
                if (lives <= 0) {
                    alert(`GAME OVER! Final Score: ${score}\nMade by Luffy with Triyaki, Hazan & Berserk!`);
                    document.location.reload();
                } else resetBall();
            }

            if (ball.y > paddle.y && ball.x > paddle.x && ball.x < paddle.x + paddle.w) {
                ball.dy = -Math.abs(ball.dy);
                ball.dx = ((ball.x - paddle.x) / paddle.w - 0.5) * 10;
            }

            bricks = bricks.filter((brick) => {
                if (ball.x > brick.x && ball.x < brick.x + brick.w && ball.y > brick.y && ball.y < brick.y + brick.h) {
                    ball.dy *= -1;
                    brick.health--;
                    if (brick.health <= 0) {
                        score += 100;
                        document.getElementById("progress-bar").style.width = `${(score / (bricks.length + 1)) * 100}%`;
                        return false;
                    }
                }
                return true;
            });

            if (bricks.length === 0) {
                level++;
                alert(`LEVEL UP! Next Stage...`);
                createLevel();
                resetBall();
            }

            document.getElementById("score").textContent = score;
            document.getElementById("lives").textContent = lives;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "cyan";
            ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.size, 0, Math.PI * 2);
            ctx.fill();

            bricks.forEach((brick) => {
                ctx.fillStyle = brick.color;
                ctx.fillRect(brick.x, brick.y, brick.w, brick.h);
            });
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.dx = 4;
            ball.dy = -4;
        }

        gameLoop();
    </script>
</body>
</html>
